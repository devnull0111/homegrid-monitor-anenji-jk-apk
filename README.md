# HomeGrid Monitor (APK Release)

Android APK для локального моніторингу інвертора та BMS:
- інвертор: **ANENJI 4.2 kW** (Modbus через datalogger)
- BMS: **JK-PB2A16S20P (JK v19)** по BLE

Цей репозиторій містить лише готовий APK та документацію по запуску.

## Навіщо створено

Цей проєкт робився з практичною метою: отримати **real-time моніторинг інвертора максимально простим способом**, без ESP-контролерів, окремих шлюзів та додаткового "заліза".

За основу взято **старий Android-телефон** як постійний локальний хаб: він одночасно спілкується з інвертором (SmartESS-подібний локальний сценарій) і з JK BMS, та віддає єдиний web-дашборд.

У підсумку вийшло просте рішення "встановив і користуєшся": локальний моніторинг інвертора + BMS з можливістю віддаленого перегляду (через доступ до телефона в мережі / VPN / проброс, залежно від вашої схеми).

## Що це за проєкт

`HomeGrid Monitor` запускає на Android локальний сервіс, який:
- читає дані інвертора по TCP/UDP (через Wi-Fi datalogger);
- читає дані JK BMS по BLE;
- піднімає локальний web-дашборд (HTTP + WebSocket) для перегляду з телефона/ПК в одній мережі.

## Що нового

- Підвищена стабільність 24/7: покращено автовідновлення після збоїв зв’язку з інвертором та BMS.
- Додано внутрішні watchdog-перевірки для сервісів (API/інвертор/BMS) з автоматичним самовідновленням.
- Дашборд запускається стабільніше разом із застосунком, без ручних дій після відкриття.
- Оновлено статуси з’єднань у UI: зрозуміліші індикатори для інвертора та BMS.
- Виправлено дублювання підписів статусів у головному екрані.
- Додано PIN-захист дашборда:
  - PIN за замовчуванням: `0000`;
  - підтримка PIN довжиною від 1 до 16 цифр;
  - PIN можна змінити з веб-інтерфейсу.
- Сесія входу зроблена максимально довгою для сценарію домашнього хаба (до зміни PIN/виходу).
- Покращено обробку помилок у телеметрії та енергозведеннях для великих вибірок даних.
- Оптимізовано енергоспоживання без втрати надійності (обережні зміни для фонового режиму).
## Поточні можливості

- Live-моніторинг інвертора: напруга, частота, струм, потужність, режими, температура.
- Live-моніторинг BMS: SOC/SOH, струм, потужність, температури, комірки, дельта, балансування.
- Детальна сторінка BMS (`/bms_details.html`):
  - `Settings / Flags / Config`;
  - редагування підтриманих параметрів (включно з `SOC Re-Bulk`).
- Сторінка налаштувань інвертора (`/inverter_settings.html`):
  - вкладки по категоріях;
  - читання та запис підтриманих параметрів.
- Графіки в дашборді: `Power`, `Voltage`, `Current`, `Thermal`, `Cells`, `Energy`.
- Локальний API + WebSocket для оновлень у реальному часі.
- Стабільний фоновий режим: foreground service, автозапуск, keep-alive.

## Перевірена сумісність

Тестувалось на:
- **Inverter:** ANENJI 4.2 kW
- **BMS:** JK-PB2A16S20P, протокол JK v19

Примітка:
- BLE у JK зазвичай допускає **лише одне активне підключення одночасно**. Якщо відкрита штатна BMS-апка, HomeGrid може не підключитися.

## Вміст репозиторію

- `apk/HomeGridMonitor-v1.0-debug.apk` — готовий APK
- `photo/` — скріншоти інтерфейсу

## Скріншоти

### APK (головний екран)
![APK Main Screen](photo/apkPhoto.png)

### Dashboard (головна)
![Dashboard Main](photo/index-2026-02-11-17_22_42.png)

### BMS Details
![BMS Details](photo/bms-details-html-2026-02-11-17_23_26.png)

### Inverter Settings
![Inverter Settings](photo/inverter-settings-html-2026-02-11-17_22_59.png)

## Швидкий старт

1. Встановіть APK на Android-пристрій.
2. Надайте дозволи (Bluetooth, Nearby devices, Notifications тощо).
3. У застосунку задайте:
   - MAC BMS (можна через scan);
   - IP інвертора;
   - local IP (IP телефона у вашій LAN);
   - TCP/UDP порти (зазвичай `8899` / `58899`).
4. Натисніть **Start monitoring**.
5. Відкрийте дашборд:
   - на телефоні: вбудований WebView;
   - з ПК/іншого пристрою в LAN: `http://<IP_телефона>:18899/`.

## Важливі мережеві рекомендації (дуже бажано)

Для стабільної роботи краще заздалегідь закріпити IP у роутері (DHCP reservation):

1. Закріпити IP для телефона (де запущено застосунок).
2. Закріпити IP для Wi-Fi datalogger інвертора.
3. Перевірити, що обидва пристрої в одній підмережі (наприклад `192.168.0.x`).
4. Вимкнути AP Isolation / Client Isolation на Wi-Fi мережі.
5. На телефоні вимкнути агресивну економію батареї для застосунку.

Чому це важливо:
- при зміні IP після перезавантаження роутера/пристроїв втрачається звʼязок;
- фіксовані DHCP lease прибирають «плаваючі» відвали по адресі.

## Значення за замовчуванням

- Локальний API/дашборд порт: `18899`
- TCP інвертора: `8899`
- UDP інвертора: `58899`

## Обмеження та особливості

- Це локальний моніторинг всередині вашої мережі.
- JK BMS BLE: одне активне клієнтське підключення.
- При недоступності інвертора/мережі дашборд показує останню доступну телеметрію та помилки зв’язку.

## Усунення проблем

### BMS не підключається
- Закрийте офіційну BMS-апку.
- Перезапустіть Bluetooth.
- Перевірте правильність MAC.

### Інвертор не відповідає
- Перевірте IP/порти інвертора.
- Перевірте, що телефон та інвертор в одній LAN.
- Перевірте налаштування роутера (ізоляція клієнтів).

### Дашборд не відкривається з ПК
- Перевірте, що сервіс запущено в застосунку.
- Перевірте IP телефона та порт `18899`.
- Перевірте firewall/гостьову мережу роутера.

## Безпека

Рекомендується використовувати застосунок лише у довіреній локальній мережі.

## Ліцензія

За замовчуванням без окремої open-source ліцензії (all rights reserved), якщо не вказано інше власником проєкту.


